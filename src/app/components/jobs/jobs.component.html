<!--<app-navbar></app-navbar>-->
<div class="container mt-6">
  <div class="box-area">
    <div class="row">
      <div class="col-md-12">
        <app-errors></app-errors>
        <div #message></div>

        <div class="menu_dot_area">
          <button  class="border btn pr-3 pt-2 pb-2 pl-3" [matMenuTriggerFor]="menu">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <mat-menu #menu="matMenu">
            <a href="javascript:void(0)" mat-menu-item>Show/Hide Archive  &nbsp;
              <mat-slide-toggle [(ngModel)]="isChecked"></mat-slide-toggle>
            </a>
          </mat-menu>
        </div>
        <div class="overflow-x-auto">
          <mat-tab-group class="mat-group-content" [selectedIndex]="selectedTab" (selectedTabChange)="handleTabChange($event)">
  
            <mat-tab label="Unreleased Certificates ({{unReleasedPage.totalElements}})">
              <div class="table-container mt-5">
                <table
                matSort 
                (matSortChange)="sortData($event, 'unreleased')" 
                class="table table-header hoverEffect table-bordered table-rounded">
                  <tr>
                    <th mat-sort-header="updatedAt">
                      <h6>Last Acted On</h6>
                    </th>
                    <th>
                      <h6>Certificate Name</h6>
                    </th>
                  </tr>
                  <tr *ngFor="let element of unReleasedJobsDataSource">
                    <td>
                      {{element.updatedAt|dateAgo}}
                    </td>
                    <td class="fields">
                      {{element.certificateTemplateName}}
                    </td>
                    <td class="hover_details">
                      <ul class="actiion_list">
                        <li>
                          <a class="btn-orange-outline-border" (click)="validateOnServer(element)">Validate</a>
                        </li>
                        <li>
                          <a (click)="downloadCertificates(element)" class="btn-orange-outline-border">Download</a>
                        </li>
                        <li>
                          <a class="btn-orange-outline-border" mwlConfirmationPopover [popoverTitle]="deletePopoverTitle"
                          [popoverMessage]="deletePopoverMessage" placement="left"
                          (confirm)="archiveJob(element)">Archive</a>
                        </li>
                        <li>
                          <a [routerLink]="'/Certificates/View/'+element.id" class="btn-orange-outline-border">View</a>
                        </li>
                      </ul>
                    </td>
                  </tr>
                </table>
              </div>
            </mat-tab>
  
            <mat-tab label="Released Certificates ({{releasedPage.totalElements}})">
              <form *ngIf="jobsForm" [formGroup]="jobsForm">
                <div class="table-container">
                  <table
                  matSort 
                (matSortChange)="sortData($event, 'released')"  
                  mat-table formArrayName="allJobs" [dataSource]="releasedJobsDataSource" matSort 
                    class="table hoverEffect table-header table-bordered table-rounded">
  
                    <ng-container matColumnDef="release">
                      <th mat-header-cell *matHeaderCellDef  mat-sort-header="last_released_on">
                        <img src="{{assets_loc}}assets/release.svg" />
                      </th>
                      <td mat-cell *matCellDef="let element; let rowIndex = index" (click)="$event.stopPropagation()">
                        <a (click)="submit(element,'release')" class="view-link">Release</a>
                        <p *ngIf="element.last_released_on">Last Released on <br>{{element.last_released_on}}</p>
                      </td>
                    </ng-container>
  
                    <ng-container matColumnDef="created_at">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header="created_at">
                        <h6>Released</h6>
                      </th>
                      <td mat-cell *matCellDef="let element let rowIndex = index" (click)="$event.stopPropagation()">
                        {{element.created_at|dateAgo}} </td>
                    </ng-container>
  
                    <ng-container matColumnDef="name">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header="certificateTemplateName">
                        <h6>Name</h6>
                      </th>
                      <td mat-cell *matCellDef="let element let rowIndex = index" (click)="$event.stopPropagation()">
  
                        {{element.certificateTemplateName}}
                      </td>
                    </ng-container>
  
                    <!-- <ng-container matColumnDef="status">
                      <th mat-header-cell *matHeaderCellDef>
                        <h6>Status</h6>
                      </th>
                      <td mat-cell *matCellDef="let element let rowIndex = index" (click)="$event.stopPropagation()">
                        {{element.status}} </td>
                    </ng-container> -->
  
  
                    <ng-container matColumnDef="noOfRecipients">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header="no_of_recipients">
                        <h6>Recipients</h6>
                      </th>
                      <td mat-cell *matCellDef="let element let rowIndex = index" (click)="$event.stopPropagation()">
                        {{element.no_of_recipients}} </td>
                    </ng-container>
  
                    <ng-container matColumnDef="seen">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header="seen">
                        <h6>Seen</h6>
                      </th>
                      <td mat-cell *matCellDef="let element">
                        {{ element.seen }}
                      </td>
                    </ng-container>
  
                    <ng-container matColumnDef="shared">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header="share">
                        <h6>Shared</h6>
                      </th>
                      <td mat-cell *matCellDef="let element">
                        {{ element.share }}
                      </td>
                    </ng-container>
  
                    <ng-container  matColumnDef="hovereffect">
                      <th mat-header-cell *matHeaderCellDef>
                        
                      </th>
                      <td mat-cell class="hover_details" *matCellDef="let element">
                          <ul class="actiion_list">
                            <li>
                              <a (click)="regenerateCertificates(element)" class="btn-orange-outline-border">Regenerate</a>
                            </li>
                            <li>
                              <a (click)="validateOnServer(element)" class="btn-orange-outline-border">Validate</a>
                            </li>
                            <li>
                              <a (click)="downloadCertificates(element)" class="btn-orange-outline-border">Download</a>
                            </li>
                            <li>
                              <a class="btn-orange-outline-border" mwlConfirmationPopover [popoverTitle]="deletePopoverTitle"
                          [popoverMessage]="deletePopoverMessage" placement="left"
                          (confirm)="archiveJob(element)">Archive</a>
                            </li>
                            <li>
                              <a [routerLink]="'/Certificates/View/'+element.id" class="btn-orange-outline-border">View</a>
                            </li>
                          </ul>
                      </td>
                    </ng-container>
  
                    <tr mat-header-row *matHeaderRowDef="displayedColumnsJobs"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsJobs;"></tr>
                  </table>
  
                  <app-custom-pagination (nextPageEvent)="getNextPage()"
                    (previousPageEvent)="getPreviousPage()">
                  </app-custom-pagination>
  
                </div>
              </form>
            </mat-tab>
  
            <mat-tab label="Certificate Templates ({{templatePage.totalElements}})">
              <button class="btn-orange-outline add_certificate" (click)="generateCertificateTemplate()">
                <i class="fas fa-plus"></i> Add New Certificate Template
              </button>
              <form [formGroup]="certificateForm">
                <div>
                  <div class="table-container mt-5">
                    <div class="row certificate_templates_wrap">
                      
                      <div class="col-small" *ngFor="let element of templatesData;">
                        <div class="certificateSingle">
  
                          <img *ngIf="element.certificate_image_thumbnail; else noImage" src="data:image/png;base64,{{element.certificate_image_thumbnail.data}}" alt="">
                          <ng-template #noImage>
                            <img src="/assets/certificate.png" alt="">
                          </ng-template>
                          <h4>{{element.name}}</h4>
                          <div class="meta row">
                              <div class="col-auto">
                                <i class="fas mr-2 fa-user-friends"></i>
                                {{element.no_of_recipient}} 
                              </div>
                              <div class="col">
                                <i class="fas mr-2 fa-pencil-alt"></i> 
                                {{element.created_at|dateAgo}}
                              </div>
                          </div>
                          <div class="hoverSection">
                              <div class="row mb-2">
                                <div class="col-6">
                                  No. Of recipients:
                                </div>
                                <div class="col-6">
                                  {{element.no_of_recipient}}
                                </div>
                              </div>
                              <div class="row mb-2">
                                <div class="col-6">
                                  Last edited:
                                </div>
                                <div class="col-6">
                                  {{element.last_edited_on|dateAgo}}
                                </div>
                              </div>
                              <div class="row mb-2">
                                <div class="col-6">
                                  Lest used:
                                </div>
                                <div class="col-6">
                                  {{element.last_edited_on|dateAgo}}
                                </div>
                              </div>
                              <div class="row mb-5">
                                <div class="col-6">
                                  Date Created:
                                </div>
                                <div class="col-6">
                                  {{element.created_at|dateAgo}}
                                </div>
                              </div>
                              <a href="#" class="btn-orange-outline-border btn-block">Archive</a>
                              <a [routerLink]="'/Certificates/AddTemplate/'+element.id" class="btn-orange-outline-border btn-block">Update</a>
                          </div>
                        </div>
                      </div>
                    
                    </div>
  
  
                    <!-- <table mat-table formArrayName="allCerts" [dataSource]="certificateDataSource" matSort
                      class="mat-elevation-z8" class="table table-header table-bordered table-rounded">
                      <ng-container matColumnDef="id">
                        <th mat-header-cell *matHeaderCellDef>
                          <h6>Id</h6>
                        </th>
                        <td mat-cell *matCellDef="let element let rowIndex = index" (click)="$event.stopPropagation()">
                          {{element.id}}
                        </td>
                      </ng-container>
  
                      <ng-container matColumnDef="certificate_templates">
  
                        <th mat-header-cell *matHeaderCellDef>
                          <h6>Certificate Templates</h6>
                        </th>
                        <td mat-cell *matCellDef="let element let rowIndex = index" (click)="$event.stopPropagation()">
                          {{element.name}}
                        </td>
                      </ng-container>
  
                      <ng-container matColumnDef="no_of_recipients">
                        <th mat-header-cell *matHeaderCellDef>
                          <h6>No of Recipients</h6>
                        </th>
                        <td mat-cell *matCellDef="let element let rowIndex = index" (click)="$event.stopPropagation()">
                          {{element.no_of_recipient}}</td>
                      </ng-container>
  
                      <ng-container matColumnDef="update">
                        <th mat-header-cell *matHeaderCellDef>
                          <img src="{{assets_loc}}assets/update-tag.svg" />
                        </th>
                        <td mat-cell *matCellDef="let element let rowIndex = index" (click)="$event.stopPropagation()">
                          <a [routerLink]="'/Certificates/AddTemplate/'+element.id" class="view-link">Update</a>
                        </td>
                      </ng-container>
  
                      <tr mat-header-row *matHeaderRowDef="displayedColumnsCertificates"></tr>
                      <tr mat-row *matRowDef="let row; columns: displayedColumnsCertificates;"></tr>
                    </table> -->
  
  
                    <app-custom-pagination [page]="templatePage" (nextPageEvent)="getNextTemplatePage()"
                      (previousPageEvent)="getPreviousTemplatePage()">
                    </app-custom-pagination>
                    
                  </div>
                </div>
              </form>
            </mat-tab>
          </mat-tab-group>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="loading-indicator">
  <mat-spinner *ngIf="loader" mode="indeterminate"></mat-spinner>
</div>