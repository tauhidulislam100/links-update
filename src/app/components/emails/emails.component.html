<div class="container">
  <div class="box-area">
    <div class="row">
      <div class="col-md-12 email_inwrap">
        <app-errors></app-errors>
        <div class="alert alert-success mb-5" role="alert" *ngIf="isArchived">
          <div class="row align-items-center">
            <div class="col">
              <i class="fas fa-check-circle mr-2"></i>
              Archived Successfully.
            </div>
            <div class="col-auto">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <i class="fas fa-times-circle"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="menu_dot_area">
          <button class="border btn pr-3 pt-2 pb-2 pl-3" [matMenuTriggerFor]="menu_2">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <mat-menu #menu_2="matMenu">
            <a href="javascript:void(0)" mat-menu-item>Show/Hide Archive &nbsp;
              <mat-slide-toggle [(ngModel)]="showArchive" (change)="archiveToggle()"></mat-slide-toggle>
            </a>
            <a [routerLink]="'/Emails/unsubscribed'" mat-menu-item>
              Unsubscribed Recipients
            </a>
          </mat-menu>
        </div>
        <div class="overflow-x-auto">
          <mat-tab-group class="mat-group-content" [selectedIndex]="selectedTab"
            (selectedTabChange)="handleTabChange($event)">
            <div class="email_gp">
              <mat-tab label="Sent Emails ({{sentEmailsPage.totalElements}})">
                <div class="table-container">
                  <div class="table_overflow">
                    <table matSort (matSortChange)="sortData($event, 'sent')"
                    class="table hoverEffect table-header table-bordered table-rounded">
                    <thead>
                      <th mat-sort-header="created_at">
                        <h6>Sent </h6>
                      </th>
                      <th>
                        <h6> Subject</h6>
                      </th>
                      <th>
                        <h6>Email Template</h6>
                      </th>
                      <th mat-sort-header="no_of_recipients">
                        <h6>Recipients</h6>
                      </th>
                      <th mat-sort-header="seen">
                        <h6>Seen
                          <button
                          style="padding: 0; border-radius: 50%; box-shadow: none; line-height: normal; min-width: 0;"
                          mat-raised-button
                          matTooltip="Number of recipients who have opened the sent emails"
                          mat-tooltip-panel-below >
                          <i class="fas fa-info-circle"></i>
                        </button>
                        </h6>
                      </th>
                      <th mat-sort-header="unsubscribed">
                        <h6>Unsubscribed 
                          <button
                          style="padding: 0; border-radius: 50%; box-shadow: none; line-height: normal; min-width: 0;"
                          mat-raised-button
                          matTooltip="Number of recipients who have unsubscribed from the mailing list"
                          mat-tooltip-panel-below >
                          <i class="fas fa-info-circle"></i>
                        </button>
                        </h6>
                      </th>
                    </thead>
                    <tbody>
                      <tr *ngFor="let element of sentEmailsData" [ngClass]="{archived: element.deleted_at !== null}">
                        <td>
                          {{element.created_at|dateAgo}}
                          <div class="archive_active">
                            <!-- <i class="fas fa-file-download"></i> -->
                            <svg id="archive-24px" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                              <g id="Group_4170" data-name="Group 4170">
                                <rect id="Rectangle_121" data-name="Rectangle 121" width="18" height="18" fill="none"/>
                              </g>
                              <g id="Group_4171" data-name="Group 4171">
                                <path id="Path_231" data-name="Path 231" d="M20.54,5.23,19.15,3.55A1.451,1.451,0,0,0,18,3H6a1.486,1.486,0,0,0-1.16.55L3.46,5.23A1.958,1.958,0,0,0,3,6.5V19a2.006,2.006,0,0,0,2,2H19a2.006,2.006,0,0,0,2-2V6.5A1.958,1.958,0,0,0,20.54,5.23Zm-5.39,9.62-2.79,2.79a.5.5,0,0,1-.71,0L8.86,14.85A.5.5,0,0,1,9.21,14H11V11a1,1,0,0,1,2,0v3h1.79A.5.5,0,0,1,15.15,14.85ZM5.12,5l.81-1h12l.94,1Z" fill="#707070"/>
                              </g>
                            </svg>                            
                          </div>
                        </td>
                        <td>
                          {{element.emailTemplate ? element.emailTemplate.subject : element.adminEmailTemplate ? element.adminEmailTemplate.subject : null}}
                        </td>
                        <td>
                          {{element.emailTemplate ? element.emailTemplate.name : element.adminEmailTemplate ? element.adminEmailTemplate.name : null}}
                        </td>
                        <td>
                          {{element.no_of_recipients}}
                        </td>
                        <td>
                          {{element.seen}}
                        </td>
                        <td>
                          {{element.unsubscribed}}
                        </td>
                        <td class="hover_details">
                          <ul class="actiion_list">
                            <li>
                              <a class="btn-orange-outline-border" mwlConfirmationPopover
                                [popoverTitle]="deletePopoverTitle" [popoverMessage]="deletePopoverMessage"
                                placement="left" (confirm)="archiveEmailJob(element)">Archive</a>
                            </li>
                            <li>
                              <a (click)="loader = true" [routerLink]="'/Emails/View/'+element.id"
                                class="btn-orange-outline-border">View</a>
                            </li>
                          </ul>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  </div>

                  <app-custom-pagination [page]="sentEmailsPage" pageName="Sent Emails" (nextPageEvent)="getJobsNextPage()"
                    (previousPageEvent)="getJobsPreviousPage()">
                  </app-custom-pagination>
                </div>
              </mat-tab>
              <mat-tab label="Email Templates ({{allTemplatesPage.totalElements}})">
                <button class="btn-orange-outline add_new_email_template" (click)="generateEmailTemplate()">
                  <i class="fas fa-plus"></i> Add New Email Template
                </button>
                <div class="table-container">
                  <div class="table_overflow">
                      <table matSort (matSortChange)="sortData($event, 'e-templates')"
                        class="table hoverEffect table-header table-bordered table-rounded">
                        <thead>
                          <th mat-sort-header="created_at">
                            <h6>Created On</h6>
                          </th>
                          <th>
                            <h6>Subject</h6>
                          </th>
                          <th>
                            <h6>Email Templates</h6>
                          </th>
                          <th mat-sort-header="no_of_recipients">
                            <h6>Recipients</h6>
                          </th>
                          <th mat-sort-header="no_of_times_used">
                            <h6>Times Used
                              <button
                              style="padding: 0; border-radius: 50%; box-shadow: none; line-height: normal; min-width: 0;"
                              mat-raised-button
                              matTooltip="Lorem ipsum dolor sit amet, consetetur sadipscing elitr"
                              mat-tooltip-panel-below >
                              <i class="fas fa-info-circle"></i>
                            </button>
                            </h6>
                          </th>
                        </thead>
                        <tbody>
                          <tr *ngFor="let element of emailTemplatesData">
                            <td>
                              {{element.created_at|dateAgo}}
                            </td>
                            <td>
                              {{element.subject}}
                            </td>
                            <td>
                              {{element.name}}
                            </td>
                            <td>
                              {{element.no_of_recipients}}
                            </td>
                            <td>
                              {{element.no_of_times_used}}
                            </td>
                            <td class="hover_details">
                              <ul class="actiion_list">
                                <li>
                                  <a (click)="loader=true" [routerLink]="'/Emails/UpdateTemplate/'+element.id"
                                    class="btn-orange-outline-border" style="cursor: pointer;">Update</a>
                                </li>
                                <li>
                                  <a class="btn-orange-outline-border" mwlConfirmationPopover
                                    [popoverTitle]="deletePopoverTitle" [popoverMessage]="deletePopoverMessage"
                                    placement="left" (confirm)="archive(element)">Archive</a>
                                </li>
                              </ul>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                  </div>
                  <app-custom-pagination [page]="allTemplatesPage" pageName="Email Templates" (nextPageEvent)="getTemplatesNextPage()"
                    (previousPageEvent)="getTemplatesPreviousPage()">
                  </app-custom-pagination>
                </div>
              </mat-tab>

              <mat-tab label="Mapped Email Templates ({{allMappedTemplatesPage.totalElements}})">
                <div class="table-container">
                  <div class="table_overflow">
                      <table matSort (matSortChange)="sortData($event, 'm-templates')"
                        class="table hoverEffect table-header table-bordered table-rounded">
                        <thead>
                          <th mat-sort-header="created_at">
                            <h6>Created</h6>
                          </th>
                          <th>
                            <h6>Subject</h6>
                          </th>
                          <th>
                            <h6>Email Templates</h6>
                          </th>
                          <th mat-sort-header="no_of_recipients">
                            <h6>Recipients</h6>
                          </th>
                          <th mat-sort-header="no_of_times_used">
                            <h6>Times Used
                              <button
                              style="padding: 0; border-radius: 50%; box-shadow: none; line-height: normal; min-width: 0;"
                              mat-raised-button
                              matTooltip="Lorem ipsum dolor sit amet, consetetur sadipscing elitr"
                              mat-tooltip-panel-below >
                              <i class="fas fa-info-circle"></i>
                              </button>
                            </h6>
                          </th>
                        </thead>
                        <tbody>
                          <tr *ngFor="let element of allMapedTemplatesData">
                            <td>
                              {{element.created_at|dateAgo}}
                            </td>
                            <td>
                              {{element.subject}}
                            </td>
                            <td>
                              {{element.name}}
                            </td>
                            <td>
                              {{element.no_of_recipients}}
                            </td>
                            <td>
                              {{element.no_of_times_used}}
                            </td>
                            <td class="hover_details">
                              <ul class="actiion_list">
                                <li>
                                  <a [routerLink]="'/Emails/AddTemplate/'+element.id+'/mapped'"
                                    class="btn-orange-outline-border">Update</a>
                                </li>
                                <li>
                                  <a [routerLink]="" class="btn-orange-outline-border" (click)="archive(element)">
                                    Archive</a>
                                </li>
                              </ul>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                  </div>
                  <app-custom-pagination [page]="allMappedTemplatesPage" pageName="Mapped Email Templates" (nextPageEvent)="getMappedTemplatesNextPage()"
                    (previousPageEvent)="getMappedTemplatesPreviousPage()">
                  </app-custom-pagination>
                </div>
              </mat-tab>
            </div>
          </mat-tab-group>
        </div>
      </div>
    </div>
  </div>
</div>